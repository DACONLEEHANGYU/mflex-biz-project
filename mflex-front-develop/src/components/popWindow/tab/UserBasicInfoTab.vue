<template>
  <div class="pop-window">
    <div class="window-body">
      <div class="window-content pt15">
        <div class="tab-comtent__row">
          <div class="window-top">
            <!-- <button class="btn-s" @click="onUserLock">ì ê¸ˆ/ì ê¸ˆí•´ì œ</button>
            <button class="btn-s" @click="onUserActivate">í™œì„±í™”/ì •ì§€</button> -->
          </div>
          <div class="inputs-wrap">
            <div class="input-form">
              <table class="input-table">
                <colgroup>
                  <col width="20%" />
                  <col width="30%" />
                  <col width="20%" />
                  <col width="30%" />
                </colgroup>
                <tbody>
                  <tr>
                    <th>ì‚¬ìš©ì ID</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.userId"
                          readonly
                        />
                      </div>
                    </td>
                    <th>ì‚¬ìš©ìëª…</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.userName"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>ì‚¬ìš©ììƒíƒœ</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userState"
                          readonly
                        />
                      </div>
                    </td>

                    <th>ìŠ¹ì¸ ìƒíƒœ</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.approvalStatus"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>ì‚¬ìš©ì ìœ í˜•</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.userTypeName"
                          readonly
                        />
                      </div>
                    </td>
                    <th>ì´ë©”ì¼</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.email"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>íšŒì‚¬ì „í™”ë²ˆí˜¸</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.officePhoneNumber"
                          readonly
                        />
                      </div>
                    </td>
                    <th>íœ´ëŒ€í°ë²ˆí˜¸</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.personalPhoneNumber"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>ì§ê¸‰</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.positionName"
                          readonly
                        />
                      </div>
                    </td>
                    <th>ì‚¬ìš©ìíƒ€ì…</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.userTypeName"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>ê¸°ê´€</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.instituteName"
                          readonly
                        />
                      </div>
                    </td>
                    <th>ë¶€ì„œ</th>
                    <td class="manage-input-form-td">
                      <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetails.departmentName"
                          readonly
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>ì ê¸ˆìƒíƒœ</th>
                    <td class="manage-input-form-td">
                      <!-- <div class="td-col">
                        <input
                          class="input-text"
                          type="text"
                          v-model="userDetail.locked"
                          readonly
                        />
                      </div> -->
                      <div class="td-col">
                        <i
                          v-if="userDetails.locked"
                          class="icon-cell__lock"
                        ></i>
                        <i v-else class="icon-cell__unlock"></i>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="window-footer">
      <div class="inputs-btns">
        <div class="btns__r">
          <button class="btn-m confirm" @click="onResetPassWord">
            ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
          </button>
          <button class="btn-m confirm" @click="onConfirm">í™•ì¸</button>
          <button class="btn-m close" @click="onClose">ë‹«ê¸°</button>
        </div>
      </div>
    </div> -->
  </div>

  <AppWindow :view="mngResetWindeView" @close="onCloseMngResetWindow">
    <ManagerResetPassWordWindow
      :userId="userDetail.userId"
      @close="onCloseMngResetWindow"
    >
    </ManagerResetPassWordWindow>
  </AppWindow>

  <AppWindow
    width="500px"
    :view="userApproValView"
    @close="onCloseUserApproval"
  >
    <UserApprovalWindow @close="onCloseUserApproval"> </UserApprovalWindow>
  </AppWindow>
</template>
<script setup>
  import { computed, onMounted, reactive, ref, watch, inject } from 'vue';
  import { useAuthStore } from '@/stores/auth';
  import { storeToRefs } from 'pinia';
  import wordDivisionCellRender from '@/utils/wordDivisionCellRender.js';
  import AppTooltip from '@/components/ui/AppTooltip.vue';
  import AppWindow from '@/components/ui/AppWindow.vue';
  import ManagerResetPassWordWindow from '@/components/popWindow/ManagerResetPassWordWindow.vue';
  import UserApprovalWindow from '@/components/popWindow/UserApprovalWindow.vue';
  import {
    activeUserByAdmin, // ì‚¬ìš©ì í™œì„±í™”/ë¹„í™œì„±í™”
    lockUserByAdmin, // ì‚¬ìš©ì ì ê¸ˆ/í•´ì œ
    getResourceInstitute,
    getResourceInfoSystem,
    getResourceDictionary,
  } from '@/utils/mflexApi/userManagementApi.js';
  /*  const onConfirm = () => {
        emit('confirm', this.selectedRow);
        emit('close');
      }; */

  const props = defineProps({
    userDetails: Object,
  });

  const userDetails = inject('userDetails', props.userDetails);

  console.log('inject userDetials : ', userDetails);

  const emit = defineEmits(['close']);

  const userDetail = ref({});

  onMounted(() => {
    userDetail.value = props.userDetails;
  });

  // const userDetail = ref(props.userDetails);
  // console.log('userDetail', userDetail);

  // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” íŒì—… ìƒíƒœ
  const mngResetWindeView = ref(false);

  // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” íŒì—… ì¶œë ¥
  const onResetPassWord = () => {
    mngResetWindeView.value = true;
  };

  const onClose = () => {
    emit('close');
  };

  const onCloseMngResetWindow = () => {
    mngResetWindeView.value = false;
    // emit('close');
  };

  const userApproValView = ref(false);

  // ì‚¬ìš©ì ìŠ¹ì¸ íŒì—… ì¶œë ¥
  const onUserApproval = () => {
    userApproValView.value = true;
  };

  // ì‚¬ìš©ì ìŠ¹ì¸ íŒì—… ë‹«ê¸°
  const onCloseUserApproval = () => {
    userApproValView.value = false;
  };

  // ì‚¬ìš©ì í™œì„±í™”/ì •ì§€
  const onUserActivate = async () => {
    console.log('onUserActivate');

    const activeInfo = {
      userId: userDetail.value.userId,
      state: userDetail.value.userState === 'WILT' ? 'active' : 'inactive',
    };

    const response = await activeUserByAdmin(activeInfo);
    console.log('response', response);

    if (response.status === 200 && userDetail.value.userState === 'WILT') {
      alert('ì‚¬ìš©ìê°€ í™œì„±í™” ë˜ì—ˆìŠµë‹ˆë‹¤.');
      return;
    } else {
      alert('ì‚¬ìš©ìê°€ ë¹„í™œì„±í™” ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì‚¬ìš©ììƒíƒœ
  const userState = computed(() => {
    const userStateIcon = ref('');

    if (
      userDetails.userState === 'SEED' ||
      userDetails.userState === 'SEED_ADMIN'
    ) {
      userStateIcon.value = 'ğŸŒ°';
      // return 'ğŸŒ°';
    } else if (userDetails.userState === 'SPROUT') {
      userStateIcon.value = 'ğŸŒ±';
      // return 'ğŸŒ±';
    } else if (userDetails.userState === 'TREE') {
      userStateIcon.value = 'ğŸŒ³';
      // return 'ğŸŒ³';
    } else if (userDetails.userState === 'WILT') {
      userStateIcon.value = 'ğŸ‚';
      // return 'ğŸ‚';
    }

    return userStateIcon.value;
  });

  const onUserLock = async () => {
    console.log('onUserLock');

    const lockInfo = {
      userId: userDetail.value.userId,
      state: userDetail.value.locked === false ? 'lock' : 'unlock',
    };

    const response = await lockUserByAdmin(lockInfo);
    console.log('response', response);

    if (response.status === 200 && userDetail.value.locked === true) {
      alert('ì‚¬ìš©ìê°€ ì ê¸ˆ í•´ì œ ë˜ì—ˆìŠµë‹ˆë‹¤.');
      return;
    } else {
      alert('ì‚¬ìš©ìê°€ ì ê¸ˆ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };
</script>
